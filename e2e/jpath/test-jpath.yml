setup:
  files:
    - path: .gflows/config.yml
      content: |
        templates:
          engine: jsonnet
          defaults:
            jsonnet:
              jpath:
                - vendor
    - path: .gflows/vendor/steps.libsonnet
      content: |
        {
          run(command):: {
            run: command
          }
        }
    - path: .gflows/workflows/test.jsonnet
      content: |
        local steps = import 'steps.libsonnet'; 
        std.manifestYamlDoc({
          'on': {
            push: {
              branches: ['develop']
            }
          },
          jobs: {
            hello: {
              'runs-on': 'ubuntu-latest',
              steps: [
                steps.run('echo hello, world!')
              ]
            }
          }
        })
    - path: .github/workflows/test.yml
      content: |
        # File generated by gflows, do not modify
        # Source: .gflows/workflows/test.jsonnet
        "jobs":
          "hello":
            "runs-on": "ubuntu-latest"
            "steps":
            - "run": "echo hello, world!"
        "on":
          "push":
            "branches":
            - "develop"


run: check --show-diffs

expect:
  output: |
    Checking test ... OK
    Workflows up to date
