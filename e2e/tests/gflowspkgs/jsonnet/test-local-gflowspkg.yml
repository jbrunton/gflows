setup:
  files:
    - path: my-lib/gflowspkg.json
      source: e2e/gflowspkgs/jsonnet/gflowspkg.json
    - path: my-lib/libs/common/steps.libsonnet
      source: e2e/gflowspkgs/jsonnet/libs/common/steps.libsonnet
    - path: my-lib/libs/common/git.libsonnet
      source: e2e/gflowspkgs/jsonnet/libs/common/git.libsonnet
    - path: my-lib/libs/common/workflows.libsonnet
      source: e2e/gflowspkgs/jsonnet/libs/common/workflows.libsonnet
    - path: .gflows/config.yml
      content: |
        templates:
          engine: jsonnet
          defaults:
            dependencies:
            - ../my-lib
    - path: .gflows/workflows/test.jsonnet
      content: |
        local steps = import 'common/steps.libsonnet';
        local workflow = {
          'on': {
            push: {},
          },
          jobs: {
            test: {
              'runs-on': 'ubuntu-latest',
              steps: [
                steps.run('echo Hello World!!!')
              ],
            },
          },
        };
        std.manifestYamlDoc(workflow, quote_keys=false)

run: update

expect:
  output: |2
         create .github/workflows/test.yml (from .gflows/workflows/test.jsonnet)

  files:
  - path: .gflows/config.yml
  - path: .gflows/workflows/test.jsonnet
  - path: my-lib/gflowspkg.json
  - path: my-lib/libs/common/steps.libsonnet
  - path: my-lib/libs/common/git.libsonnet
  - path: my-lib/libs/common/workflows.libsonnet
  - path: .github/workflows/test.yml
    content: |
      # File generated by gflows, do not modify
      # Source: .gflows/workflows/test.jsonnet
      jobs:
        test:
          runs-on: "ubuntu-latest"
          steps:
          - run: "echo Hello World!!!"
      "on":
        push: {}
      
